<!--pages/profile/profile-new.wxml - ä¸ªäººä¸­å¿ƒï¼ˆç¾åŒ–ç‰ˆï¼‰-->
<view class="profile-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration">
    <view class="bg-header"></view>
    <view class="bg-pattern"></view>
  </view>

  <!-- ç”¨æˆ·å¡ç‰‡ -->
  <view class="user-card">
    <!-- å¤´åƒåŒºåŸŸ -->
    <view class="avatar-section">
      <view class="avatar-wrapper" bindtap="changeAvatar">
        <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" wx:if="{{userInfo.avatarUrl}}"/>
        <view class="avatar-placeholder" wx:else>
          <text>{{userInfo.nickname[0] || 'æ¸¸'}}</text>
        </view>
        <view class="avatar-edit-badge">
          <text>ğŸ“·</text>
        </view>
      </view>
      <view class="level-ring" style="--progress: {{levelProgress}}%">
        <view class="level-badge">
          <text class="level-num">{{userInfo.level || 1}}</text>
        </view>
      </view>
    </view>
    
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="user-info">
      <view class="user-name-row">
        <text class="user-name">{{userInfo.nickname || 'æ¸¸å®¢ç©å®¶'}}</text>
        <view class="vip-badge" wx:if="{{userInfo.vip}}">
          <text>ğŸ‘‘ VIP{{userInfo.vipLevel}}</text>
        </view>
      </view>
      <text class="user-id">ID: {{userInfo.id || '000000'}}</text>
      <view class="user-signature" bindtap="editSignature">
        <text class="signature-text">{{userInfo.signature || 'è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™~'}}</text>
        <text class="signature-edit">âœï¸</text>
      </view>
    </view>
    
    <!-- è´§å¸ -->
    <view class="currency-row">
      <view class="currency-item" bindtap="goToShop">
        <text class="currency-icon">ğŸª™</text>
        <text class="currency-value">{{userInfo.coins || 0}}</text>
        <view class="currency-add">+</view>
      </view>
      <view class="currency-item" bindtap="goToShop">
        <text class="currency-icon">ğŸ’</text>
        <text class="currency-value">{{userInfo.diamonds || 0}}</text>
        <view class="currency-add">+</view>
      </view>
    </view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡é¢æ¿ -->
  <view class="stats-panel">
    <view class="stats-header">
      <text class="stats-title">æˆ˜ç»©ç»Ÿè®¡</text>
      <text class="stats-more" bindtap="goToRecordDetail">è¯¦æƒ… â€º</text>
    </view>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalGames || 0}}</text>
        <text class="stat-label">æ€»åœºæ¬¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-value win">{{stats.wins || 0}}</text>
        <text class="stat-label">èƒœåœº</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.winRate || '0%'}}</text>
        <text class="stat-label">èƒœç‡</text>
      </view>
      <view class="stat-item">
        <text class="stat-value highlight">{{stats.maxWinStreak || 0}}</text>
        <text class="stat-label">æœ€å¤§è¿èƒœ</text>
      </view>
    </view>
    
    <!-- è¿‘æœŸæˆ˜ç»© -->
    <view class="recent-record">
      <text class="recent-title">è¿‘10åœºæˆ˜ç»©</text>
      <view class="record-dots">
        <view class="record-dot {{item ? 'win' : 'lose'}}" wx:for="{{recentResults}}" wx:key="index"></view>
      </view>
    </view>
  </view>

  <!-- æˆå°±å±•ç¤º -->
  <view class="achievement-panel">
    <view class="panel-header">
      <text class="panel-title">ğŸ† æˆå°±å¾½ç« </text>
      <text class="panel-more" bindtap="goToAchievements">æŸ¥çœ‹å…¨éƒ¨ â€º</text>
    </view>
    <scroll-view class="achievement-scroll" scroll-x="true">
      <view class="achievement-list">
        <view class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}" 
              wx:for="{{achievements}}" wx:key="id" bindtap="showAchievementDetail" data-id="{{item.id}}">
          <view class="achievement-icon">
            <text>{{item.icon}}</text>
          </view>
          <text class="achievement-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-panel">
    <view class="menu-group">
      <view class="menu-item" bindtap="goToInventory">
        <view class="menu-icon-wrap">
          <text class="menu-icon">ğŸ’</text>
        </view>
        <text class="menu-text">æˆ‘çš„èƒŒåŒ…</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToCollection">
        <view class="menu-icon-wrap">
          <text class="menu-icon">ğŸƒ</text>
        </view>
        <text class="menu-text">å¡ç‰Œæ”¶è—</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToRecord">
        <view class="menu-icon-wrap">
          <text class="menu-icon">ğŸ“Š</text>
        </view>
        <text class="menu-text">æˆ˜ç»©è®°å½•</text>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>
    
    <view class="menu-group">
      <view class="menu-item" bindtap="goToFriends">
        <view class="menu-icon-wrap">
          <text class="menu-icon">ğŸ‘¥</text>
        </view>
        <text class="menu-text">æˆ‘çš„å¥½å‹</text>
        <view class="menu-badge" wx:if="{{friendRequests > 0}}">{{friendRequests}}</view>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToMail">
        <view class="menu-icon-wrap">
          <text class="menu-icon">ğŸ“¬</text>
        </view>
        <text class="menu-text">æ¶ˆæ¯é‚®ä»¶</text>
        <view class="menu-badge" wx:if="{{unreadMails > 0}}">{{unreadMails}}</view>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>
    
    <view class="menu-group">
      <view class="menu-item" bindtap="goToSettings">
        <view class="menu-icon-wrap">
          <text class="menu-icon">âš™ï¸</text>
        </view>
        <text class="menu-text">è®¾ç½®</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToHelp">
        <view class="menu-icon-wrap">
          <text class="menu-icon">â“</text>
        </view>
        <text class="menu-text">å¸®åŠ©ä¸­å¿ƒ</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToFeedback">
        <view class="menu-icon-wrap">
          <text class="menu-icon">ğŸ’¬</text>
        </view>
        <text class="menu-text">æ„è§åé¦ˆ</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToAbout">
        <view class="menu-icon-wrap">
          <text class="menu-icon">â„¹ï¸</text>
        </view>
        <text class="menu-text">å…³äºæ¸¸æˆ</text>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½• -->
  <view class="logout-section">
    <view class="logout-btn" bindtap="onLogout">
      <text>é€€å‡ºç™»å½•</text>
    </view>
    <text class="version-info">ç‰ˆæœ¬ {{version}}</text>
  </view>

  <!-- ç­¾åç¼–è¾‘å¼¹çª— -->
  <view class="modal-overlay {{showSignatureModal ? 'show' : ''}}" bindtap="closeSignatureModal">
    <view class="modal-container" catchtap="">
      <view class="modal-header">
        <text class="modal-title">ç¼–è¾‘ç­¾å</text>
        <view class="modal-close" bindtap="closeSignatureModal">âœ•</view>
      </view>
      <view class="modal-body">
        <textarea class="signature-input" placeholder="å†™ç‚¹ä»€ä¹ˆå§..." value="{{tempSignature}}" bindinput="onSignatureInput" maxlength="50"/>
        <text class="char-count">{{tempSignature.length || 0}}/50</text>
        <view class="modal-actions">
          <view class="btn-cancel" bindtap="closeSignatureModal">å–æ¶ˆ</view>
          <view class="btn-confirm" bindtap="saveSignature">ä¿å­˜</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆå°±è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay {{showAchievementModal ? 'show' : ''}}" bindtap="closeAchievementModal">
    <view class="modal-container achievement-detail" catchtap="">
      <view class="achievement-detail-icon">
        <text>{{selectedAchievement.icon}}</text>
      </view>
      <text class="achievement-detail-name">{{selectedAchievement.name}}</text>
      <text class="achievement-detail-desc">{{selectedAchievement.description}}</text>
      <view class="achievement-progress" wx:if="{{!selectedAchievement.unlocked}}">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{selectedAchievement.progress}}%"></view>
        </view>
        <text class="progress-text">{{selectedAchievement.current}}/{{selectedAchievement.target}}</text>
      </view>
      <view class="achievement-reward">
        <text class="reward-label">è§£é”å¥–åŠ±</text>
        <text class="reward-value">{{selectedAchievement.reward}}</text>
      </view>
    </view>
  </view>
</view>
